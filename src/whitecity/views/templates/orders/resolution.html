{% extends "whitecity/views/templates/market.html" %}
{% block content %}
{{order}}
{{resolutions}}
<h1 class="jumbo">Order Information</h1>
<span>order #<a href="/market/order/{{id}}/">{{id}}</a></span>
{% if status = 2 %}

{% if not resolutions|empty? %}
<table class="table resolution fill p">
  <thead>
    <tr>
      <th>from</th>
      <th class="large-column" style="width:70%">message</th>
      <th>action</th>
      <th>freshness</th>
      <th>&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    {% for resolution in resolutions %}
    <tr>
      <td>
        {% if resolution.from_user %}
          <span class="sender">{{user.alias}}</span>
        {% else %}
          <a href="/market/user/{{resolution.user_id}}" class="sender">{{resolution.alias}}</a>
        {% endif %}
      </td>
      <td>
        {{resolution.content}}
      </td>
      <td>
        {% ifequal resolution.action "extension" %}
        extend by {{resolution.value}} day{% if not resolution.value = 1 %}s{% endif %}
        {% endifequal %}
        {% ifequal resolution.action "refund" %}
        refund {{resolution.value}}%
        {% endifequal %}
      </td>
      <td><span time="{{resolution.created_on|date:fullDateTime}}" class="pretty-time">{{resolution.create_on|date:shortDate}}</span></td>
      <td>
        {% if not resolution.user_accepted %}
          <a href="/market/resolution/{{resolution.id}}/accept">accept</a>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
<form class="well" action="/market/order/{{order_id}}" method="POST">
  Propose a resolution:
  <ul>
    <li>
    <input type="radio" name="action" {% ifequal action "extension" %}checked="checked"{% endifequal %} value="extension" />
      <label for="extension">Extension:</label>
      <input name="extension" class="text-input input-2" maxlength="2" id="extension" type="text" value="{{extension}}" />
      days
      {% if extension %}
      <strong class="error">{{errors.value|join:", "}}</strong>
      {% endif %}
    </li>
    <li>
    <input type="radio" name="action" {% ifequal action "refund" %}checked="checked"{% endifequal %} value="refund" />
      <label for="refund">Refund:</label>
      <input name="refund" class="text-input input-3" maxlength="3" id="refund" type="text" value="{{refund}}" />
      %
      {% if refund %}
      <strong class="error">{{errors.value|join:", "}}</strong>
      {% endif %}
    </li>
  </ul>
  <p>
    <label for="message">Message:</label>
    <textarea rows="6" id="message" name="content" class="form-control">{{content}}</textarea>
  </p> 
  <span class="submit">
    <input type="submit" class="btn" value="send" />
  </span>
  {% csrf-token %}
</form>
{% endif %}
{% endblock %}
