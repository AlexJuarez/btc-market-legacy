{% extends "whitecity/views/templates/market.html" %}
{% block content %}
<div class="inbox">
  <h1 class="jumbo">my messages</h1>
  <nav class="nav"><a href="/messages">inbox <strong>{{user.messages.unread}}</strong></a> - <a href="/messages/sent">sent</a></nav>
</div>
{% if not messages|empty? %}
<a class="right" href="/messages/{{user_id}}/download">download thread</a>
<table class="table thread">
  <thead>
    <tr>
      <th>from</th>
      <th class="large-column">message</th>
      <th>freshness</th>
      <th>&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    {% for message in messages %}
    <tr>
      <td>
        {% if message.feedback_id %}
          <strong class="support">Support Staff</strong>
        {% else %}
          {% ifequal user.id message.sender_id %}
            <span class="sender">{{user.alias}}</span>
          {% else %}
            <a href="/user/{{message.sender_id}}" class="sender">{{message.user_alias}}</a>
          {% endifequal %}
        {% endif %}
      </td>
      <td>
        {% if not message.subject|empty? %}
          <div class="header">
            <strong class="subject">Subject: {{message.subject}}</strong>
          </div>
        {% endif %}
        <pre class="content">{{message.content}}</pre>
      </td>
      <td><span title="{{message.created_on|date:fullDateTime}}" class="pretty-time">{{message.create_on|date:shortDate}}</span></td>
      <td>{% ifequal message.user_id user.id %}<a href="/message/{{message.id}}/delete">delete</a>{% endifequal %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
<form class="well" action="/messages/{{user_id}}" method="POST">
  <p>Compose a message to: <strong>{{alias}}</strong></p>
  <p>
    <label for="subject">Subject:{% if errors.title %}{{errors.title|join:", "}}{% endif %}</label>
    <input name="subject" class="text-input" id="subject" type="text" value="{{subject}}" />
    {% if has_pub_key %}<label><input type="checkbox" value="true" name="encrypt" />Encrypt?</label>{% endif %}
  </p>
  {% if errors.content %}
  <p>{{errors.content|join:", "}}</p>
  {% endif %}
  <p>
    <textarea rows="6" name="content" class="form-control">{{content}}</textarea>
  </p> 
  <span class="submit">
    <input type="submit" class="btn" value="send" />
  </span>
  {% csrf-token %}
</form>
{% endblock %}
